{"version":3,"file":"ractive-router.umd.js","sources":["../src/ractive-router.js"],"sourcesContent":["import Ractive from 'ractive';\nimport hasher from 'hasher';\nimport crossroads from 'crossroads';\n\nexport default Ractive.extend({\n    template: `\n        <main class=\"routeContainer\"></main>\n    `,\n    oninit () {\n        this.routes = [];\n        this.currentComponent = undefined;\n\n        this.routesConfig = this.get('routesConfig');\n        Object.keys(this.routesConfig).map((pattern) => {\n            let routeConfig = this.routesConfig[pattern];\n            let routeObject = crossroads.addRoute(pattern, function () {\n                let container = this.find('main.routeContainer');\n                //\n                let values = arguments;\n                let pathParamNames = crossroads.patternLexer.getParamIds(pattern);\n                let pathParams = pathParamNames.reduce((result, field, index) => {\n                    result[field] = values[index] || undefined;\n                    return result;\n                }, {});\n                //\n                let callback = routeConfig.callback instanceof Function ? routeConfig.callback : undefined;\n                let component = routeConfig.component;\n                if (component) {\n                    this.currentComponent = new component({\n                        el: container,\n                        data: {\n                            pathParams,\n                            parentGlobals: this.get('globals')\n                        },\n                        oncomplete () {\n                            if (callback) callback(pathParams);\n                        }\n                    });\n                } else {\n                    if (callback) callback(pathParams);\n                }\n            }.bind(this));\n            this.routes.push(routeObject);\n        });\n        //\n        this.observe('globals', function (globals) {\n            if (this.currentComponent && this.currentComponent.update) {\n                this.currentComponent.update('parentGlobals');\n            }\n        });\n        //\n        crossroads.bypassed.add(function () {\n            hasher.replaceHash('404');\n        });\n    },\n    onrender () {\n        let parseHash = function (newHash, oldHash) {\n            crossroads.parse(newHash);\n        };\n        hasher.initialized.add(parseHash);\n        hasher.changed.add(parseHash);\n        hasher.prependHash = '';\n        hasher.init();\n        //launch home\n        if (!location.hash) {\n            var pattern = Object.keys(this.routesConfig).find((patten)=> {\n                return this.routesConfig[patten].index;\n            });\n            if (pattern) {\n                hasher.replaceHash(pattern);\n            }\n        }\n    }\n});"],"names":[],"mappings":"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"}