{"version":3,"file":"ractive-router.es.js","sources":["../src/ractive-router.js"],"sourcesContent":["import Ractive from 'ractive';\nimport hasher from 'hasher';\nimport crossroads from 'crossroads';\n\nlet RactiveRouter = Ractive.extend({\n    template: `<main class=\"routeContainer\"></main>`,\n    oninit () {\n        //Will hold all constructed crossroads Route objects, for a further use I didn't find yet\n        this.routesObjects = [];\n\n        //The current componet the Router displays at a time\n        this.currentComponent = undefined;\n\n        //Get user config\n        this.routesConfig = this.get('routesConfig');\n\n        //Register for every route, a callback that will display the matching Component\n        Object.keys(this.routesConfig).map((routePattern) => {\n\n            let routeObject = crossroads.addRoute(routePattern, function () {\n                let routeConfig = this.routesConfig[routePattern];\n\n                //Build a Route Params Object that will be available in child Component Data\n                let routeParams = this.buildRouteParams(routePattern, arguments);\n\n                //Prepare Route callback, if applied\n                let callback = routeConfig.callback instanceof Function ? routeConfig.callback : undefined;\n\n                //Create the Route Component or just execute the Route Callback\n                if (routeConfig.component) {\n                    this.currentComponent = new routeConfig.component({\n                        el: this.find('main.routeContainer'),\n                        data: {\n                            routeParams,\n                            parentGlobals: this.get('globals')\n                        },\n                        oncomplete () {\n                            if (callback) callback(routeParams);\n                        }\n                    });\n                } else {\n                    if (callback) callback(routeParams);\n                }\n            }.bind(this));\n            this.routesObjects.push(routeObject);\n        });\n\n        //Observe Global Data and notify current route Component\n        this.observe('globals', function (globals) {\n            if (this.currentComponent && this.currentComponent.update) {\n                this.currentComponent.update('parentGlobals');\n            }\n        });\n\n        //Redirect Not found route to 404\n        crossroads.bypassed.add(function () {\n            hasher.replaceHash('404');\n        });\n    },\n    onrender () {\n        //Hasher init\n        let parseHash = function (newHash, oldHash) {\n            crossroads.parse(newHash);\n        };\n        hasher.initialized.add(parseHash);\n        hasher.changed.add(parseHash);\n        hasher.prependHash = '';\n        hasher.init();\n\n        //Launch home\n        if (!location.hash) {\n            this.navigateToHome();\n        }\n    },\n    buildRouteParams (routePattern, values) {\n        let routeParamNames = crossroads.patternLexer.getParamIds(routePattern);\n        let result = routeParamNames.reduce((result, field, index) => {\n            let value = values[index];\n            if (typeof values[index] !== 'object') {\n                result[field] = values[index] || undefined;\n            } else {\n                Object.keys(value).map((key) => {\n                    result[key] = value[key];\n                });\n            }\n            return result;\n        }, {});\n        return result;\n    },\n    navigateToHome () {\n        var routePattern = Object.keys(this.routesConfig).find((patten)=> {\n            return this.routesConfig[patten].index;\n        });\n        if (routePattern) {\n            hasher.replaceHash(routePattern);\n        }\n    }\n});\n\n//Programatically navigate to a new route\nRactiveRouter.go = (hash) => {\n    hasher.setHash(hash);\n}\n\n//Similar to Router.go(hash), but doesn't create a new record in browser history.\nRactiveRouter.replace = (hash) => {\n    hasher.replaceHash(hash);\n}\n\nexport default RactiveRouter;"],"names":[],"mappings":"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"}